/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Kotlin application project to get you started.
 */

plugins {
    id "org.flywaydb.flyway" version "6.2.3" // note: flyway tasks
    id "org.springframework.boot" version "2.2.4.RELEASE"
    id "io.spring.dependency-management" version "1.0.9.RELEASE"
    id "org.jetbrains.kotlin.jvm" version "1.3.61"
    id "org.jetbrains.kotlin.plugin.spring" version "1.3.61" // note: enable final class to be open
    id "org.jetbrains.kotlin.plugin.allopen" version "1.3.61"
    id "org.jetbrains.kotlin.plugin.jpa" version "1.3.61" // note: enable constructor without parameters for JPA
    id "java"
}

group = "com.jc"
version = "0.0.1-SNAPSHOT"
sourceCompatibility = 11

repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
    mavenCentral()
}

// note: use for devtools
configurations {
    developmentOnly
    runtimeClasspath {
        extendsFrom developmentOnly
    }
}

// note: add linting config
apply from: rootProject.file("lint-config.gradle")

dependencies {
    developmentOnly "org.springframework.boot:spring-boot-devtools"
    implementation "org.springframework.boot:spring-boot-starter-data-jpa"
    implementation "org.springframework.boot:spring-boot-starter-web"
    implementation "org.jetbrains.kotlin:kotlin-reflect"
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8"

    testImplementation("org.springframework.boot:spring-boot-starter-test") {
        exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
    }

    implementation "mysql:mysql-connector-java:8.0.19"
    implementation "log4j:log4j:1.2.17"
    implementation "joda-time:joda-time:2.10.5"

    implementation("org.flywaydb:flyway-core:6.2.3") // note: flyway library
    implementation("com.fasterxml.jackson.module:jackson-module-kotlin") // note: json
}

compileKotlin {
    kotlinOptions {
        //allWarningsAsErrors = true
        freeCompilerArgs = ["-Xjsr305=strict"]
        jvmTarget = "11"
    }
}
compileTestKotlin {
    kotlinOptions {
        allWarningsAsErrors = true
        freeCompilerArgs = ["-Xjsr305=strict"]
        jvmTarget = "11"
    }
}

// note: flyway db configuration
flyway {
    String databaseHost = project.findProperty("dbHost") ?: "localhost"
    String databaseName = project.findProperty("dbName") ?: "playground"
    String databaseUsername = project.findProperty("dbUsername") ?: "user"
    String databasePassword = project.findProperty("dbPassword") ?: "pass"
    url = "jdbc:mysql://${databaseHost}:6606/${databaseName}?user=${databaseUsername}&password=${databasePassword}"
}